(import
  (prefix (micascheme) %)
  (z80 asm)
  (z80 keywords))

(%define-rule-syntax (check-asm (op out %...) %...)
  (%begin
    (%check-datum=?
      (op->asm (%syntax op))
      (%syntax (asm out %...))) %...))

(check-asm
  ((ld b b)       (db #b01000000))
  ((ld b c)       (db #b01000001))
  ((ld b d)       (db #b01000010))
  ((ld b e)       (db #b01000011))
  ((ld b h)       (db #b01000100))
  ((ld b l)       (db #b01000101))
  ((ld b (hl))    (db #b01000110))
  ((ld b a)       (db #b01000111))

  ((ld c b)       (db #b01001000))
  ((ld c c)       (db #b01001001))
  ((ld c d)       (db #b01001010))
  ((ld c e)       (db #b01001011))
  ((ld c h)       (db #b01001100))
  ((ld c l)       (db #b01001101))
  ((ld c (hl))    (db #b01001110))
  ((ld c a)       (db #b01001111))

  ((ld d b)       (db #b01010000))
  ((ld d c)       (db #b01010001))
  ((ld d d)       (db #b01010010))
  ((ld d e)       (db #b01010011))
  ((ld d h)       (db #b01010100))
  ((ld d l)       (db #b01010101))
  ((ld d (hl))    (db #b01010110))
  ((ld d a)       (db #b01010111))

  ((ld e b)       (db #b01011000))
  ((ld e c)       (db #b01011001))
  ((ld e d)       (db #b01011010))
  ((ld e e)       (db #b01011011))
  ((ld e h)       (db #b01011100))
  ((ld e l)       (db #b01011101))
  ((ld e (hl))    (db #b01011110))
  ((ld e a)       (db #b01011111))

  ((ld h b)       (db #b01100000))
  ((ld h c)       (db #b01100001))
  ((ld h d)       (db #b01100010))
  ((ld h e)       (db #b01100011))
  ((ld h h)       (db #b01100100))
  ((ld h l)       (db #b01100101))
  ((ld h (hl))    (db #b01100110))
  ((ld h a)       (db #b01100111))

  ((ld l b)       (db #b01101000))
  ((ld l c)       (db #b01101001))
  ((ld l d)       (db #b01101010))
  ((ld l e)       (db #b01101011))
  ((ld l h)       (db #b01101100))
  ((ld l l)       (db #b01101101))
  ((ld l (hl))    (db #b01101110))
  ((ld l a)       (db #b01101111))

  ((ld (hl) b)    (db #b01110000))
  ((ld (hl) c)    (db #b01110001))
  ((ld (hl) d)    (db #b01110010))
  ((ld (hl) e)    (db #b01110011))
  ((ld (hl) h)    (db #b01110100))
  ((ld (hl) l)    (db #b01110101))
  ((halt)         (db #b01110110))
  ((ld (hl) a)    (db #b01110111))

  ((ld a b)       (db #b01111000))
  ((ld a c)       (db #b01111001))
  ((ld a d)       (db #b01111010))
  ((ld a e)       (db #b01111011))
  ((ld a h)       (db #b01111100))
  ((ld a l)       (db #b01111101))
  ((ld a (hl))    (db #b01111110))
  ((ld a a)       (db #b01111111))

  ((ld b foo)     (db #b00000110) (db foo))
  ((ld c foo)     (db #b00001110) (db foo))
  ((ld d foo)     (db #b00010110) (db foo))
  ((ld e foo)     (db #b00011110) (db foo))
  ((ld h foo)     (db #b00100110) (db foo))
  ((ld l foo)     (db #b00101110) (db foo))
  ((ld (hl) foo)  (db #b00110110) (db foo))
  ((ld a foo)     (db #b00111110) (db foo))

  ((ld ixh ixh)   (db #xdd) (db #b01100100))
  ((ld ixh ixl)   (db #xdd) (db #b01100101))
  ((ld ixl ixh)   (db #xdd) (db #b01101100))
  ((ld ixl ixl)   (db #xdd) (db #b01101101))

  ((ld iyh iyh)   (db #xfd) (db #b01100100))
  ((ld iyh iyl)   (db #xfd) (db #b01100101))
  ((ld iyl iyh)   (db #xfd) (db #b01101100))
  ((ld iyl iyl)   (db #xfd) (db #b01101101)))
