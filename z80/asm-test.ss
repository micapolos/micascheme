(import
  (only (micascheme) define-check-datum-> define-rule-syntax ... check-datum=? begin syntax quote)
  (z80 asm)
  (z80 keywords))

; (define-rule-syntax (check-asm2 (op out ...) ...)
;   (begin (check-datum=? (op->asm #'op) #'(asm out ...)) ...))

(define-check-datum-> asm)

(check-asm (op (ld b b))    (asm (db #b01000000)))
(check-asm (op (ld b c))    (asm (db #b01000001)))
(check-asm (op (ld b d))    (asm (db #b01000010)))
(check-asm (op (ld b e))    (asm (db #b01000011)))
(check-asm (op (ld b h))    (asm (db #b01000100)))
(check-asm (op (ld b l))    (asm (db #b01000101)))
(check-asm (op (ld b (hl))) (asm (db #b01000110)))
(check-asm (op (ld b a))    (asm (db #b01000111)))

(check-asm (op (ld c b))    (asm (db #b01001000)))
(check-asm (op (ld c c))    (asm (db #b01001001)))
(check-asm (op (ld c d))    (asm (db #b01001010)))
(check-asm (op (ld c e))    (asm (db #b01001011)))
(check-asm (op (ld c h))    (asm (db #b01001100)))
(check-asm (op (ld c l))    (asm (db #b01001101)))
(check-asm (op (ld c (hl))) (asm (db #b01001110)))
(check-asm (op (ld c a))    (asm (db #b01001111)))

(check-asm (op (ld d b))    (asm (db #b01010000)))
(check-asm (op (ld d c))    (asm (db #b01010001)))
(check-asm (op (ld d d))    (asm (db #b01010010)))
(check-asm (op (ld d e))    (asm (db #b01010011)))
(check-asm (op (ld d h))    (asm (db #b01010100)))
(check-asm (op (ld d l))    (asm (db #b01010101)))
(check-asm (op (ld d (hl))) (asm (db #b01010110)))
(check-asm (op (ld d a))    (asm (db #b01010111)))

(check-asm (op (ld e b))    (asm (db #b01011000)))
(check-asm (op (ld e c))    (asm (db #b01011001)))
(check-asm (op (ld e d))    (asm (db #b01011010)))
(check-asm (op (ld e e))    (asm (db #b01011011)))
(check-asm (op (ld e h))    (asm (db #b01011100)))
(check-asm (op (ld e l))    (asm (db #b01011101)))
(check-asm (op (ld e (hl))) (asm (db #b01011110)))
(check-asm (op (ld e a))    (asm (db #b01011111)))

(check-asm (op (ld h b))    (asm (db #b01100000)))
(check-asm (op (ld h c))    (asm (db #b01100001)))
(check-asm (op (ld h d))    (asm (db #b01100010)))
(check-asm (op (ld h e))    (asm (db #b01100011)))
(check-asm (op (ld h h))    (asm (db #b01100100)))
(check-asm (op (ld h l))    (asm (db #b01100101)))
(check-asm (op (ld h (hl))) (asm (db #b01100110)))
(check-asm (op (ld h a))    (asm (db #b01100111)))

(check-asm (op (ld l b))    (asm (db #b01101000)))
(check-asm (op (ld l c))    (asm (db #b01101001)))
(check-asm (op (ld l d))    (asm (db #b01101010)))
(check-asm (op (ld l e))    (asm (db #b01101011)))
(check-asm (op (ld l h))    (asm (db #b01101100)))
(check-asm (op (ld l l))    (asm (db #b01101101)))
(check-asm (op (ld l (hl))) (asm (db #b01101110)))
(check-asm (op (ld l a))    (asm (db #b01101111)))

(check-asm (op (ld (hl) b)) (asm (db #b01110000)))
(check-asm (op (ld (hl) c)) (asm (db #b01110001)))
(check-asm (op (ld (hl) d)) (asm (db #b01110010)))
(check-asm (op (ld (hl) e)) (asm (db #b01110011)))
(check-asm (op (ld (hl) h)) (asm (db #b01110100)))
(check-asm (op (ld (hl) l)) (asm (db #b01110101)))
(check-asm (op (halt))        (asm (db #b01110110)))
(check-asm (op (ld (hl) a)) (asm (db #b01110111)))

(check-asm (op (ld a b))    (asm (db #b01111000)))
(check-asm (op (ld a c))    (asm (db #b01111001)))
(check-asm (op (ld a d))    (asm (db #b01111010)))
(check-asm (op (ld a e))    (asm (db #b01111011)))
(check-asm (op (ld a h))    (asm (db #b01111100)))
(check-asm (op (ld a l))    (asm (db #b01111101)))
(check-asm (op (ld a (hl))) (asm (db #b01111110)))
(check-asm (op (ld a a))    (asm (db #b01111111)))

(check-asm (op (ld b foo))    (asm (db #b00000110) (db foo)))
(check-asm (op (ld c foo))    (asm (db #b00001110) (db foo)))
(check-asm (op (ld d foo))    (asm (db #b00010110) (db foo)))
(check-asm (op (ld e foo))    (asm (db #b00011110) (db foo)))
(check-asm (op (ld h foo))    (asm (db #b00100110) (db foo)))
(check-asm (op (ld l foo))    (asm (db #b00101110) (db foo)))
(check-asm (op (ld (hl) foo)) (asm (db #b00110110) (db foo)))
(check-asm (op (ld a foo))    (asm (db #b00111110) (db foo)))

(check-asm (op (ld ixh ixh))  (asm (db #xdd) (db #b01100100)))
(check-asm (op (ld ixh ixl))  (asm (db #xdd) (db #b01100101)))
(check-asm (op (ld ixl ixh))  (asm (db #xdd) (db #b01101100)))
(check-asm (op (ld ixl ixl))  (asm (db #xdd) (db #b01101101)))

(check-asm (op (ld iyh iyh))  (asm (db #xfd) (db #b01100100)))
(check-asm (op (ld iyh iyl))  (asm (db #xfd) (db #b01100101)))
(check-asm (op (ld iyl iyh))  (asm (db #xfd) (db #b01101100)))
(check-asm (op (ld iyl iyl))  (asm (db #xfd) (db #b01101101)))
